<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Light Sensor Data</title>
</head>
<body>
<style>
@keyframes fadeIn {
    from { opacity: 0;  bottom: 20px; }
    to { opacity: 1; bottom: 0px; }
}

#container {
    height: 400px;
    width: 680px;
    margin: 0 auto;
    background-color: rgb(222,222,222);
    position: relative;
    font-family: sans-serif;
    overflow: hidden;
    border-radius: 5px;
}

.bar-container {
    width: 90%;
    border: 1px solid black;
    border-radius: 5px;
    margin: 10px auto;
    height: 30px;
    background-color: white;
    padding: 3px;
}

.bar {
    width: 0%;
    background-color: blue;
    height: 100%;
    border-radius: inherit;
}

.bar-label {
    width: 100%;
}

.bar-label * {
    position: absolute;
    top: 31%;
}

.current-level-container {
    margin-top: 30px;
    text-align: center;
    font-size: 50px;
    height: 225px;
    overflow: inherit;
}

.current-level-item {
    position: relative;
    animation: fadeIn 0.5s;
}

.tiny-message {
    font-size: 10px;
    position: absolute;
    left: 59%;
    top: 46%;
}

.zero {
    left: 5%;
}

.thousand {
    right: 5%;
}

h1 {
    text-align: center;
}

</style>
<div id="container" style="height: 400px; min-width: 310px">
    <h1>Light Level</h1>
    <div class="bar-container">
        <div class="bar"></div>
    </div>
    <div class="bar-label">
        <span class="zero">0</span>
        <span class="thousand">1000</span>
    </div>
    <div class="current-level-container"></div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-color/2.1.2/jquery.color.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script>

    function determineColor(data) {
        var alpha;
        if (data < 250) {
            alpha = '1';
        } else if (data < 500) {
            alpha = '0.9';
        } else if (data < 750) {
            alpha = '0.7';
        } else {
            alpha = '0.5';
        }
        return "rgba(72,165,226," + alpha + ")";
    }

    function determineExtraMessage(data) {
        var message;
        if (data < 125) {
            message = '- oh, so dark';
        } else if (data > 900){
            message = '- oof, it\'s like being on the sun';
        }
        return message;
    }

    var wsClient = new WebSocket("ws://light.dpmercado.com:8768");
    wsClient.onopen = function(){
        console.log('Connection open!');
    };

    wsClient.onmessage = function (message) {
        var maxLevels = 40;
        var incomingData = parseInt(message.data, 10);
        var extraMessage = determineExtraMessage(incomingData);
        var color = determineColor(incomingData);
        var width = ((incomingData / 1000) * 100) + "%";
        var $currentLevels = $('.current-level-item');

        $('.bar').animate({ width : width, backgroundColor: color });
        if (length === maxLevels) {
             $currentLevels.last().remove();
        }
        $('.current-level-container').prepend(
                "<div class=\"current-level-item\">"
                + incomingData
                + (extraMessage
                    ? "<span class='tiny-message'>" + extraMessage + "</span>"
                    : '')
                + "</div>");

    };

    wsClient.onerror = function (error) {
        console.log(error);
    }

</script>
</body>
</html>